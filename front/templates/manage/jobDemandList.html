{# #author:无名 #}
{# #datetime:2019/4/17 0017 18:03#}
{# #software: PyCharm#}
{% extends "base.html" %}
{% block title %}
    岗位需求管理
{% endblock %}
{% block tan %}
    <form class="layui-form" action="" id="form1" style="display: none;width:90%">
        {% csrf_token %}
        <div class="layui-form-item" style="margin-top: 10px">
            <label class="layui-form-label">公司</label>
            <div class="layui-input-block">
                <select name="company_id" lay-verify="required">
                    <option value=""></option>
                    {% for company in company_list %}
                        <option value={{ company.id }}>{{ company.code }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">岗位</label>
            <div class="layui-input-block">
                <select name="job_id" lay-verify="required">
                    <option value=""></option>
                    {% for job in job_list %}
                        <option value={{ job.id }}>{{ job.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">待招聘人数</label>
            <div class="layui-input-block">
                <input type="text" name="nums" required lay-verify="required" placeholder="请输入待招聘人数" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">岗位职责</label>
            <div class="layui-input-block">
                <textarea name="work" placeholder="请输入岗位职责" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">任职资格</label>
            <div class="layui-input-block">
                <textarea name="need" placeholder="请输入任职资格" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block">
                <input type="radio" name="sex" value="男" title="男">
                <input type="radio" name="sex" value="女" title="女">
                <input type="radio" name="sex" value="男女不限" title="男女不限" checked>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">学历</label>
            <div class="layui-input-block">
                <input type="text" name="edu" required lay-verify="required" placeholder="请输入学历"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">工作年限</label>
            <div class="layui-input-block">
                <input type="text" name="work_years" required lay-verify="required" placeholder="请输入工作年限"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">必备条件</label>
            <div class="layui-input-block">
                <textarea name="essential_condition" placeholder="请输入必备条件" class="layui-textarea"></textarea>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">招聘渠道</label>
            <div class="layui-input-block">
                <input type="text" name="recruitment_way" required lay-verify="required" placeholder="请输入招聘渠道"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">试用期薪资</label>
            <div class="layui-input-block">
                <input type="text" name="probation_salary" required lay-verify="required" placeholder="请输入试用期薪资"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">薪资</label>
            <div class="layui-input-block">
                <input type="text" name="salary" required lay-verify="required" placeholder="请输入薪资" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">薪资发放形式</label>
            <div class="layui-input-block">
                <textarea name="salary_method" placeholder="请输入薪资发放形式" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">提成绩效</label>
            <div class="layui-input-block">
                <textarea name="performance" placeholder="请输入提成绩效" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">工作时间</label>
            <div class="layui-input-block">
                <input type="text" name="work_time" required lay-verify="required" placeholder="请输入工作时间"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">每月休假</label>
            <div class="layui-input-block">
                <input type="text" name="holiday" required lay-verify="required" placeholder="请输入每月休假"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">岗位补贴</label>
            <div class="layui-input-block">
                <textarea name="job_subsidy" placeholder="请输入岗位补贴" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">生活补贴</label>
            <div class="layui-input-block">
                <textarea name="life_subsidy" placeholder="请输入生活补贴" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">住宿条件</label>
            <div class="layui-input-block">
                <input type="text" name="dorm" required lay-verify="required" placeholder="请输入住宿条件" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">其他福利</label>
            <div class="layui-input-block">
                <textarea name="welfare" placeholder="请输入其他福利" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <textarea name="note" placeholder="请输入备注" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                {#                <button type="reset" class="layui-btn layui-btn-primary">重置</button>#}
                <button class="layui-btn" lay-submit lay-filter="formDemo" onclick="postJobDemand({{ job_type }});return false">立即提交
                </button>
            </div>
        </div>
    </form>
{% endblock %}
{% block content %}
    <button class="layui-btn" onclick="onAddBtn()">
        {% if job_type == 1 %}
            添加岗位需求
        {% elif job_type == 2 %}
            添加外籍需求
        {% endif %}
    </button>
    <table class="layui-table">
{#        <colgroup>#}
{#            <col width="150">#}
{#            <col width="200">#}
{#            <col>#}
{#        </colgroup>#}
        <thead>
        <tr>
            <th>公司代码</th>
            <th>岗位</th>
            <th>待招聘人数</th>
            <th>性别</th>
            <th>任职资格</th>
            <th>学历</th>
            <th>工作年限</th>
            <th>招聘渠道</th>
            <th>试用期薪资</th>
            <th>薪资</th>
            <th>休假</th>
            <th>住宿条件</th>
            <th>更新时间</th>
            <th>详情</th>
            <th>删除</th>
        </tr>
        </thead>
        <tbody>
        {% for jobDemand in posts %}
            <tr>
                <td>{{ jobDemand.company.code }}</td>
                <td>{{ jobDemand.job.name }}</td>
                <td>{{ jobDemand.nums}}</td>
                <td>{{ jobDemand.get_sex_display}}</td>
                <td>{{ jobDemand.need}}</td>
                <td>{{ jobDemand.edu}}</td>
                <td>{{ jobDemand.work_years}}</td>
                <td>{{ jobDemand.recruitment_way}}</td>
                <td>{{ jobDemand.probation_salary}}</td>
                <td>{{ jobDemand.salary}}</td>
                <td>{{ jobDemand.holiday}}</td>
                <td>{{ jobDemand.dorm}}</td>
                <td>{{ jobDemand.update_time}}</td>
                <td>
                    {% if job_type == 1 %}
                        <a class="layui-btn layui-btn-warm layui-btn-sm" href="{% url 'manager:jobDemand' jobDemand.id %}" >详情</a>
                    {% elif job_type == 2 %}
                        <a class="layui-btn layui-btn-warm layui-btn-sm" href="{% url 'manager:foreignJobDemand' jobDemand.id%}">详情</a>
                    {% endif %}
                </td>
                <td>
                    <button class="layui-btn  layui-btn-danger layui-btn-sm" onclick="delJobDemand({{ jobDemand.id }},{{ job_type }})">删除
                    </button>

                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
{% block paginator %}
    {% include 'paginator.html' %}
{% endblock %}
{% block script %}
    <script>
        var url = "{% url 'manager:jobDemand' %}";
        function onAddBtn() {
            //页面层-自定义
            layer.open({
                type: 1,
                title: "创建新的需求",
                skin: 'layui-layer-rim',
                area: ['800px', '800px'],
                content: $("#form1"),
            });
        }

            function postJobDemand(job_type) {
            if (job_type === 2) {
                console.log(job_type);
            url = "{% url 'manager:foreignJobDemand' %}"
        }
                rmsajax.post({
                    data: $("#form1").serialize(),
                    url: url,
                    success: function (result) {
                        if (result['code'] === 200) {
                            window.location = window.location.href;
                        }
                    }
                })
            }

            function delJobDemand(id,job_type) {
                if (job_type === 2) {
            url = "{% url 'manager:foreignJobDemand' %}"
        }
                rmsajax.delete({
                    url: url + id + "/",
                    success: function (result) {
                        window.location = window.location.href;
                    }
                })
            }

            function editJobDemand(id,job_type) {
               if (job_type === 2) {
            url = "{% url 'manager:foreignJobDemand' %}"
        }
                layer.open({
                    type: 2,
                    title: "编辑岗位需求",
                    area: ['800px', '800px'],
                    content: url + id + "/",
                    end: function () {
                        window.location = window.location.href;
                    }
                });
            }
    </script>

{% endblock %}